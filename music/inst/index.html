<!DOCTYPE html>
<html>
<head>
  <title>Mirishita Instrumentals</title>
  <meta charset="UTF-8">
  <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico"/>
  <link rel="stylesheet" type="text/css" href="./slick/slick.css">
  <style type="text/css">
    @font-face {
        font-family: Mirishita;
        src: url(./font/mirishita.ttf);
    }
  
    @font-face {
        font-family: Assistant;
        src: url(./font/assistant.ttf);
    }
    
	html, body {
	    font-family: Assistant;
        margin: 0;
        padding: 0;
		text-align: center;
		background-color: #FDFDFD;
    }

    * {
        box-sizing: border-box;
    }
	
	.sliderbackground {
		z-index: 0;
	}
	
    .slider {
        width: 100%;
        padding-top: 5%;
		z-index: 0;
    }
	
	.spacer {
		border-radius:0 0 100% 100%;
        margin-top: -5%;
        padding-bottom: 10%;
	}
	
	.all {
	    background: linear-gradient(to right, #F3F27C , #CAE9B4, #96D8EC, #BDD0EC, #F2B7E0, #BDD0EC, #96D8EC, #CAE9B4, #F3F27C);
	}
	
	.princess {
	    background: linear-gradient(to right, #E7B3A4 , #D8949F, #E690BA, #D8949F, #E7B3A4);
	}
	
	.fairy {
	    background: linear-gradient(to right, #90E8EF , #70B8DE, #6A9FEF, #70B8DE, #90E8EF);
	}
	
	.angel {
	    background: linear-gradient(to right, #D5F178 , #D7D26A, #E9CB73, #D7D26A, #D5F178);
	}
	
	.ex {
	    background: linear-gradient(to right, #B9EF8F , #80DF70, #6AEF75, #80DF70, #B9EF8F);
	}
	
    .slick-slide img {
      width: 100%;
    }

    .slick-prev:before,
    .slick-next:before {
      color: black;
    }

    .slick-slide {
      transition: all ease-in-out .3s;
	  filter: brightness(50%);
      transform: scale(.8) translateY(-12.5%);
    }

    .slick-current {
      transform: none;
	  filter: brightness(100%);
    }
	
	.nowplaying {
		margin-top: 1%;
		margin-left: 1%;
	    z-index: 1;
		position: relative;
	    float: left;
	    font-family: Assistant;
		font-size: 2vw;
	}
	
	.songname {
		margin-top: 2%;
	    font-family: Mirishita;
	    margin-left: 15.4%;
	    text-align: left;
		font-size: 3vw;
		line-height: 2.5ex;
		margin-bottom: 1%;
	}
	
	.button {
	    width: 19%;
	    font-family: Assistant;
		text-align: center;
        margin: 0% 3%;
		padding-top: 0.7%;
		padding-bottom: 0.7%;
		text-decoration: none;
		display: inline-block;
		font-size: 2.4vw;
		border-radius:5em;
		border: black;
		border-style: solid;
		border-width: thin;
	}
	
	label {
	    font-family: Assistant;
		text-align: center;
		font-size: 1.1vw;
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
        -ms-user-select: none;
		user-select: none;
		line-height: 1.4em;
		padding-top: 1%;
		padding-bottom: 1.6%;
		border: black;
		border-style: solid;
		border-width: thin;
		display: inline-block;
	    background: linear-gradient(to right, #DDE5F5, #FFFFFF);
		margin-left: -1px;
	}
	
	.radiogroup {
		position: relative;
		width: 49.5%;
		margin-top: -7.2%;
		z-index: 1;
	}
	
	.leftbutton {
	    width: 12.7%;
		border-radius:5em 0em 0em 5em;
	}
	
	.middlebutton {
	    width: 12.7%;
		border-radius:0em;
	}
	
	.rightbutton {
	    width: 12.7%;
		border-radius:0em 5em 5em 0em;
	}
	
	.redbutton {
		color: white;
	    background: linear-gradient(to right, #FF7B9E , #FF3F3F);
	}
	
	.redbutton:active {
	    background: linear-gradient(to right, #E15D80 , #E12020);
	}
	
	.whitebutton {
		color: black;
	    background: linear-gradient(to right, #FFFFFF , #DDE5F5);
	}
	
	.whitebutton:active {
	    background: linear-gradient(to right, #E1E1E1 , #BFC7D7);
	}
	
	.volume-slider {
	    width: 100%;
		padding-top: 1.3%;
		text-align: center;
		color: black;
		display: inline-block;
		font-size: 1.8vw;
		text-decoration: none;
	}
	
	input[type=range] {
	    -webkit-appearance: none;
		appearance: none;
	    width: 69.3%;
		border-radius:5em;
		background: #d3d3d3;
		outline: none;
		opacity: 0.7;
		transition: opacity .2s;
	}
	
	input[type=range]::-moz-range-track {
		padding: 1.5% 0%;
		border-radius:5em;
		background: #d3d3d3;
	}
	
	input[type=range]::-ms-track {
		height: 0%;
		display: none;
	}

	input[type=range]:hover {
		opacity: 1;
	}
	
	input[type=range]::-webkit-slider-thumb {
	    -webkit-appearance: none;
		border: 1px solid #000000;
		padding: 1.45% 0%;
		height: 100%;
		width: 3%;
		border-radius:5em;
	    background: linear-gradient(to right, #FFFFFF , #DDE5F5);
		cursor: pointer;
		margin-top: 0%;
	}

	input[type=range]::-moz-range-thumb {
	    appearance: none;
		border: 1px solid #000000;
		padding: 0.9% 0%;
		height: 100%;
		width: 3%;
		border-radius:5em;
	    background: linear-gradient(to right, #FFFFFF , #DDE5F5);
		cursor: pointer;
	}

	input[type=range]::-ms-thumb {
		border: 1px solid #000000;
		padding: 100% 100%;
		height: 100%;
		width: 100%;
		border-radius:5em;
	    background: linear-gradient(to right, #FFFFFF , #DDE5F5);
		cursor: pointer;
	}
	
	input[type="radio"] {
	    display: none;
	}
	
	input[type="radio"]:checked+label { 
		color: white;
	    background: linear-gradient(to right, #FF3F3F, #FF7B9E);
	} 
  </style>
</head>
<body>
  <div class="nowplaying" id="np"></div>
  <div class="sliderbackground"><div class="slider" id="slickslider"></div></div>
  <div class="spacer" id="spacer"></div>
  <form autocomplete="off"><div class="radiogroup"><input id="songgroup0" name="songgroup" type="radio" value="0" checked="checked" onchange="changeGroup(this.value)"><label class="leftbutton" for="songgroup0">♪<br>Normal</label><input id="songgroup1" name="songgroup" type="radio" value="1" onchange="changeGroup(this.value)"><label class="middlebutton" for="songgroup1">♪<br>Special</label><input id="songgroup2" name="songgroup" type="radio" value="2" onchange="changeGroup(this.value)"><label class="rightbutton" for="songgroup2">♪<br>Unreleased</label></div></form><br>
  <div class="songname"></div>
    <button class="button redbutton" onclick="Play()">Play</button><button class="button whitebutton" onclick="Stop()">Stop</button><a id="mp3link" href="./mp3/bgm_inst_bnthtr.mp3"><button class="button whitebutton">Download</button></a><br>
  <div class="volume-slider">Volume<br>
    <input id="volslider" class="input" type="range" min="0" max="100.0" step=".1" value="50" oninput="SetVolume(this.value)" onchange="SetVolume(this.value)"></input>
  </div>
   
  <script src="https://code.jquery.com/jquery-2.2.0.min.js" type="text/javascript"></script>
  <script src="./slick/slick.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">

if (!Array.prototype.includes) {
    Object.defineProperty(Array.prototype, "includes", {
        enumerable: false,
        value: function(obj) {
            var newArr = this.filter(function(el) {
                return el == obj;
            });
            return newArr.length > 0;
        }
    });
}

function addColor(songtype)
{
	$(".sliderbackground").addClass(songtype);
	$("#spacer").addClass(songtype);
}

function removeColor(songtype)
{
	$(".sliderbackground").removeClass(songtype);
	$("#spacer").removeClass(songtype);
}

var aud = document.createElement("AUDIO");
aud.onended = function() {
    $("#np").html("");
};

var jsondata, songdata, currsong;
var slidestoshow = 5;

$(document).on('ready', function() {
	$.getJSON("./songs.json", function(json) {
	    jsondata = json;
		initSlick(0);
	});
});

$('.slider').on('click', '.slick-slide', function (e) {
	e.stopPropagation();
	var index = $(this).data("slick-index");
	if ($('.slider').slick('slickCurrentSlide') !== index) {
	    $('.slider').slick('slickGoTo', index);
	}
});

$('.slider').on('wheel', (function(e) {
  e.preventDefault();

  if (e.originalEvent.deltaY > 0) {
    $(this).slick('slickNext');
  } else {
    $(this).slick('slickPrev');
  }
}));

$('.slider').on('beforeChange', function (e, slick, currSlide, nextSlide) {
	removeColor(currsong.type);
	currsong = songdata[nextSlide % songdata.length];
	addColor(currsong.type);
	$(".songname").html(currsong.longname);
	$("#mp3link").attr("href", "./mp3/bgm_inst_" + currsong.name + ".mp3");
});

function initSlick(index) {
	songdata = jsondata.songs[index];
	var generatedhtml = "";
	var j = 0;
	while(j < slidestoshow * 2)
	{
		$.each(songdata, function(i, data) {
			generatedhtml += '<div><img src="./jacket/jacket_' + data.name + '.png"></div>';
			++j;
		});
	}
	$("#slickslider").html(generatedhtml);
	if(currsong)
	{
		removeColor(currsong.type);
	}
	currsong = songdata[0];
	$(".songname").html(currsong.longname);
	addColor(currsong.type);
	$(".slider").slick({
		dots: false,
		infinite: true,
		centerMode: true,
		slidesToShow: slidestoshow,
		swipeToSlide: true,
		arrows: false,
		touchThreshold: 15
	});
}

function changeGroup(index) {
	$(".slider").slick("unslick");
	initSlick(index);
}

function Play() {
    aud.volume = Math.pow($("#volslider").val() / 100, 2.0);
    aud.setAttribute("src","./mp3/bgm_inst_" + currsong.name + ".mp3");
	aud.play();
	$("#np").html("▶ Now Playing: " + currsong.longname);
}

function Stop() {
    aud.pause();
	$("#np").html("");
}

function SetVolume(vol)
{
    aud.volume = Math.pow(vol / 100, 2.0);
}

</script>
</body>
</html>